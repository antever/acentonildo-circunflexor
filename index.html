<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Acentonildo Circunflexor 1.0</title>
  <link rel="stylesheet" href="estilos.css">
</head>
<body>
  <div class="container">
    <h1>Acentonildo Circunflexor 1.0</h1>
    <div class="char-buttons" id="char-buttons"></div>
    <textarea id="input" placeholder="Digite seu texto aqui..."></textarea>
    <br>
    <button id="copy-text">Copiar</button>
    <button id="clear-text">Limpar</button>
    <button id="undo-last">Desfazer última correção</button>
    <div id="status-box"></div>
  </div>

  <section class="info" style="max-width: 800px; margin: 2em auto; padding: 1em;">
    <p><strong>Acentonildo Circunflexor</strong> é uma ferramenta web de correção automática de palavras em português brasileiro (pt-BR). Conforme o usuário digita, palavras são substituídas automaticamente por suas versões corretas com base em um dicionário.</p>

    <h3>Funcionalidades</h3>
    <ul>
      <li>Correção automática de palavras ao digitar.</li>
      <li>Botões para inserir caracteres com acentuação (ex: ç, ã, ê, etc.).</li>
      <li>Opções para copiar todo o texto, apagar e desfazer a última correção do texto.</li>
    </ul>

    <h3>Estrutura</h3>
    <ul>
      <li><code>index.html</code> – Estrutura da interface.</li>
      <li><code>estilos.css</code> – Estilização da interface.</li>
      <li><code>acentuacoes.js</code> – Contém o dicionário de correções automáticas e lógica adicional.</li>
    </ul>

    <h3>Créditos</h3>
    <p>O dicionário utilizado foi baseado em uma compilação de mais de 500 mil palavras e expressões em português brasileiro feita por 
    <a href="https://github.com/j0aoarthur" target="_blank">João Arthur Britto</a> (<code>j0aoarthur</code>), disponível em: 
    <a href="https://github.com/j0aoarthur/PalavrasPT-BR" target="_blank">https://github.com/j0aoarthur/PalavrasPT-BR</a></p>
    <p>O dicionário original foi modificado para conter apenas palavras que possuem algum tipo de acento típico do português brasileiro.</p>

    <h3>Apoio</h3>
    <p>O desenvolvimento desta e de outras ferramentas é financiado com doações voluntárias. Se quiser apoiar, você pode doar aqui:</p>
    <p><a href="https://buymeacoffee.com/antever" target="_blank">https://buymeacoffee.com/antever</a></p>

    <h3>Repositório</h3>
    <p>Código-fonte disponível em: <a href="https://github.com/antever/acentonildo-circunflexor" target="_blank">https://github.com/antever/acentonildo-circunflexor</a></p>

    <h3>Requisitos</h3>
    <p>Compatível com navegadores modernos. Não requer instalação ou conexão com servidor.</p>

    <h3>Licença</h3>
    <p>Distribuído sob a <strong>GNU General Public License v3.0</strong> (GPL-3.0).</p>
    <p>Isso significa que:</p>
    <ul>
      <li>Você pode usar, estudar, modificar e distribuir este código livremente.</li>
      <li>Qualquer modificação ou redistribuição <strong>deve manter o código aberto e gratuito</strong>, sob a mesma licença GPL-3.0.</li>
    </ul>
    <p>Para mais detalhes, consulte: <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">https://www.gnu.org/licenses/gpl-3.0.html</a></p>
  </section>

  <script src="acentuacoes.js"></script>

  <script>
    const input = document.getElementById("input");
    const undoLastBtn = document.getElementById("undo-last");
    const copyTextBtn = document.getElementById("copy-text");
    const clearTextBtn = document.getElementById("clear-text");
    const charButtonsContainer = document.getElementById("char-buttons");
    const statusBox = document.getElementById("status-box");

    const charGroups = {
      "TIL (~)": ["ã", "õ", "Ã", "Õ"],
      "AGUDO (´)": ["á", "é", "í", "ó", "ú", "Á", "É", "Í", "Ó", "Ú"],
      "GRAVE (`)": ["à", "À"],
      "CIRCUNFLEXO (^)": ["â", "ê", "ô", "Â", "Ê", "Ô"],
      "CEDILHA (ç)": ["ç", "Ç"]
    };

    for (const [label, chars] of Object.entries(charGroups)) {
      const groupDiv = document.createElement("div");
      groupDiv.className = "char-group";
      const title = document.createElement("strong");
      title.textContent = label + ": ";
      groupDiv.appendChild(title);

      chars.forEach(char => {
        const btn = document.createElement("button");
        btn.textContent = char;
        btn.onclick = () => {
          input.value += char;
          input.focus();
        };
        groupDiv.appendChild(btn);
      });

      charButtonsContainer.appendChild(groupDiv);
    }

    let lastText = "";
    let confirmTimeout;

    let backspaceCount = 0;
    let lastKeyTime = 0;

    input.addEventListener("keydown", function (e) {
      const now = Date.now();
      if (e.key === "Backspace") {
        if (now - lastKeyTime < 1000) {
          backspaceCount++;
        } else {
          backspaceCount = 1;
        }

        if (backspaceCount === 4) {
          statusBox.textContent = "Quem é que tá fazendo batucada a essa hora? Segure CTRL+SHIFT e aperte setinha para a esquerda para selecionar palavras inteiras.";
          backspaceCount = 0;
        }
      } else {
        backspaceCount = 0;
      }
      lastKeyTime = now;
    });

    input.addEventListener("keyup", function (e) {
      const triggerKeys = [" ", ",", ".", ";", ":", "?", "!", "\"", "'", ")", "]", "Enter"];
      if (triggerKeys.includes(e.key)) {
        lastText = input.value;
        input.value = correctLastWord(input.value);
      }
    });

    undoLastBtn.addEventListener("click", function () {
      if (lastText) {
        input.value = lastText;
        lastText = "";
        statusBox.textContent = "Ai, nossa. Que desfeita.";
      }
    });

    copyTextBtn.addEventListener("click", function () {
      input.select();
      document.execCommand("copy");
      input.setSelectionRange(input.value.length, input.value.length);
      statusBox.textContent = "Texto copiado para a área de transferência.";

      const extraCopyBtn = document.createElement("button");
      extraCopyBtn.textContent = "Copiar";
      extraCopyBtn.disabled = true;
      extraCopyBtn.style.marginLeft = "0.5em";
      copyTextBtn.after(extraCopyBtn);

      setTimeout(() => {
        extraCopyBtn.remove();
      }, 1000);
    });

    clearTextBtn.addEventListener("click", function () {
      const confirmBtn = document.createElement("button");
      confirmBtn.textContent = "Tem certeza???";
      confirmBtn.id = "confirm-clear";
      confirmBtn.className = "confirm-clear";
      confirmBtn.style.marginRight = "0.5em";
      clearTextBtn.replaceWith(confirmBtn);

      confirmTimeout = setTimeout(() => {
        confirmBtn.replaceWith(clearTextBtn);
      }, 5000);

      confirmBtn.addEventListener("click", function () {
        clearTimeout(confirmTimeout);
        input.value = "";
        statusBox.textContent = "Texto apagado.";

        const messageBtn = document.createElement("button");
        messageBtn.textContent = "Então tá! Limpei tudo. Faz sujeira mais não, tá?";
        messageBtn.disabled = true;
        messageBtn.style.marginRight = "0.5em";
        confirmBtn.replaceWith(messageBtn);

        setTimeout(() => {
          messageBtn.replaceWith(clearTextBtn);
        }, 2000);
      });
    });

    function matchCase(original, corrected) {
      if (original === original.toUpperCase()) {
        return corrected.toUpperCase();
      } else if (original[0] === original[0].toUpperCase()) {
        return corrected.charAt(0).toUpperCase() + corrected.slice(1);
      } else {
        return corrected;
      }
    }

    function correctText(text) {
      const words = text.split(/\b/);
      let status = [];
      for (let i = 0; i < words.length; i++) {
        const raw = words[i];
        const clean = raw.normalize('NFD').replace(/[^\w]/g, "").toLowerCase();
        if (corrections[clean]) {
          const corrected = matchCase(raw, corrections[clean]);
          if (corrected !== raw) status.push(`${raw} > ${corrected}`);
          words[i] = corrected;
        }
      }
      statusBox.textContent = status.join("\n");
      return words.join("");
    }

    function correctLastWord(text) {
      const match = text.match(/(\b\w+)([.,;:?!'"()\]\s]*)$/);
      if (!match) return text;

      const [fullMatch, lastWord, spacing] = match;
      const clean = lastWord.normalize('NFD').replace(/[^\w]/g, "").toLowerCase();

      if (corrections[clean]) {
        const corrected = matchCase(lastWord, corrections[clean]);
        if (corrected !== lastWord) {
          statusBox.textContent = `${lastWord} > ${corrected}`;
        }
        return text.slice(0, -fullMatch.length) + corrected + spacing;
      }
      return text;
    }
  </script>
</body>
</html>
